{% extends 'base.html' %}
{% load humanize %}
{% load crispy_forms_tags %}
{% block content %}
    <h1>Detalles Cliente
        <small>{{ object.nombre|title }} </small>
    </h1>
    <div class="row">
        <div class="col-md-12">
            <h3>Información General</h3>
            <hr>
            <p>
                <span class="label">Nit:</span> {{ object.nit }}
            </p>
            <p>
                <span class="label">Fecha Creación:</span> {{ object.fecha_creacion }}
            </p>
            <div>
                <p>
                    <span class="label">Empresas Grupo:</span>{{ object.grupo }}
                </p>
                {% if object.grupo %}
                    <ul>
                        {% for empresa in object.grupo.mis_empresas.all %}
                            {% if empresa.nit != object.nit %}
                                <li>
                                    <a href="{{ empresa.get_absolute_url }}">{{ empresa.nombre }}
                                        - {{ empresa.nit }}</a>
                                </li>
                            {% endif %}
                        {% endfor %}
                    </ul>
                {% endif %}
            </div>
        </div>
        <div class="col-md-12">
            {% with cotizaciones_list=object.mis_cotizaciones.all %}
                {% if cotizaciones_list %}
                    <h3>Mis Cotizaciones</h3>
                    <table class="table table-bordered table-striped">
                        <thead>
                        <tr>
                            <th>
                                Nro.
                            </th>
                            <th>
                                Razón S.
                            </th>
                            <th>
                                Ciudad
                            </th>
                            <th>
                                Estado
                            </th>
                            <th>
                                Versión
                            </th>
                            <th>
                                Fecha Env.
                            </th>
                            <th>
                                Contacto
                            </th>
                            <th>
                                Nro. Contacto
                            </th>
                            <th>
                                Email
                            </th>
                            <th>
                                Total
                            </th>
                            <th>
                                Usuario
                            </th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for cotizacion in cotizaciones_list %}
                            <tr>
                                <td>
                                    <a href="{{ cotizacion.get_absolute_url }}">{{ cotizacion.nro_cotizacion }}</a>
                                </td>
                                <td>
                                    {{ cotizacion.razon_social }}
                                </td>
                                <td>
                                    {{ cotizacion.ciudad }}
                                </td>
                                <td>
                                    {{ cotizacion.get_estado_display }}
                                </td>
                                <td>
                                    {{ cotizacion.version }}
                                </td>
                                <td>
                                    {{ cotizacion.fecha_envio }}
                                </td>
                                <td>
                                    {{ cotizacion.nombres_contacto }} {{ cotizacion.apellidos_contacto }}
                                </td>
                                <td>
                                    {{ cotizacion.nro_contacto }}
                                </td>
                                <td>
                                    {{ cotizacion.email }}
                                </td>
                                <td>
                                    {{ cotizacion.total }}
                                </td>
                                <td>
                                    {{ cotizacion.usuario }}
                                </td>
                                <td>
                                    {{ cotizacion.fecha_envio|naturaltime|capfirst }}
                                </td>
                                {% with remisiones_list=cotizacion.mis_remisiones.all %}
                                    {% if remisiones_list %}
                                        <td>
                                            {% for remision in remisiones_list %}
                                                {% if remision.factura_biable %}
                                                    <a href="{{ remision.factura_biable.get_absolute_url }}"
                                                       target="popup"
                                                       onclick="window.open('{{ remision.factura_biable.get_absolute_url }}','popup','width=600,height=600'); return false;">
                                                        {{ remision.factura_biable.tipo_documento }}-{{ remision.factura_biable.nro_documento }}
                                                    </a>
                                                {% endif %}
                                                -
                                            {% endfor %}
                                        </td>
                                    {% endif %}
                                {% endwith %}
                            </tr>
                        {% empty %}
                            <li>Ninguna Cotización</li>
                        {% endfor %}
                        </tbody>
                    </table>

                {% endif %}
            {% endwith %}
        </div>
        <div class="col-md-12">
            {% with compras_list=object.mis_compras.all|slice:":20" %}
                {% if compras_list %}
                    <h3>Mis Ultimas 20 Compras</h3>
                    <table class="table table-bordered table-striped">
                        <thead>
                        <tr>
                            <th>
                                Nro.
                            </th>
                            <th>
                                Fecha
                            </th>
                            <th>
                                Departamento
                            </th>
                            <th>
                                Ciudad
                            </th>
                            <th>
                                Dirección
                            </th>
                            <th>
                                Vendedor
                            </th>
                            <th>
                                Vlr. Bruto
                            </th>
                            <th>
                                Descuentos
                            </th>
                            {% if perms.biable.ver_info_admon_ventas %}
                                <th>
                                    Costo
                                </th>
                                <th>
                                    Rentabilidad
                                </th>
                            {% endif %}
                            <th>
                                Vlr. Neto
                            </th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for compra in compras_list %}
                            <tr>
                                <td>
                                    <a href="{{ compra.get_absolute_url }}">{{ compra.tipo_documento }}-{{ compra.nro_documento }}</a>
                                </td>
                                <td>
                                    {{ compra.fecha_documento }}
                                </td>
                                <td>
                                    {{ compra.ciudad_biable.ciudad_intranet.departamento.nombre }}
                                </td>
                                <td>
                                    {{ compra.ciudad_biable.ciudad_intranet.nombre }}
                                </td>
                                <td>
                                    {{ compra.direccion_despacho }}
                                </td>
                                <td>
                                    {{ compra.vendedor.nombre|title }}
                                </td>
                                <td>
                                    {{ compra.venta_bruta|floatformat:2 }}
                                </td>
                                <td>
                                    {{ compra.dscto_netos|floatformat:2 }}
                                </td>
                                {% if perms.biable.ver_info_admon_ventas %}
                                    <td>
                                        {{ compra.costo_total|floatformat:2 }}
                                    </td>
                                    <td>
                                        {{ compra.rentabilidad|floatformat:2 }}
                                    </td>
                                {% endif %}
                                <td>
                                    {{ compra.venta_neto|floatformat:2 }}
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                {% endif %}
            {% endwith %}
        </div>
    </div>
{% endblock %}